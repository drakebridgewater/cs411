\begin{Verbatim}[commandchars=@\[\]]
@PY[c+cm][/*]
@PY[c+cm][ * elevator sstf]
@PY[c+cm][ */]
@PY[c+cp][#]@PY[c+cp][include <linux]@PY[c+cp][/]@PY[c+cp][blkdev.h>]
@PY[c+cp][#]@PY[c+cp][include <linux]@PY[c+cp][/]@PY[c+cp][elevator.h>]
@PY[c+cp][#]@PY[c+cp][include <linux]@PY[c+cp][/]@PY[c+cp][bio.h>]
@PY[c+cp][#]@PY[c+cp][include <linux]@PY[c+cp][/]@PY[c+cp][module.h>]
@PY[c+cp][#]@PY[c+cp][include <linux]@PY[c+cp][/]@PY[c+cp][slab.h>]
@PY[c+cp][#]@PY[c+cp][include <linux]@PY[c+cp][/]@PY[c+cp][init.h>]

@PY[k][struct] @PY[n][sstf_data] @PY[p][{]
        @PY[k][struct] @PY[n][list_head] @PY[n][queue]@PY[p][;]
        @PY[n][sector_t] @PY[n][head_pos]@PY[p][;]
        @PY[k+kt][int] @PY[n][direction]@PY[p][,] @PY[n][queue_count]@PY[p][;]
@PY[p][}]@PY[p][;]

@PY[k][static] @PY[k+kt][void] @PY[n+nf][sstf_merged_requests]@PY[p][(]@PY[k][struct] @PY[n][request_queue] @PY[o][*]@PY[n][q]@PY[p][,] @PY[k][struct] @PY[n][request] @PY[o][*]@PY[n][rq]@PY[p][,]
                                 @PY[k][struct] @PY[n][request] @PY[o][*]@PY[n][next]@PY[p][)]
@PY[p][{]
        @PY[n][list_del_init]@PY[p][(]@PY[o][&]@PY[n][next]@PY[o][-]@PY[o][>]@PY[n][queuelist]@PY[p][)]@PY[p][;]
@PY[p][}]

@PY[k][static] @PY[k+kt][int] @PY[n+nf][sstf_dispatch]@PY[p][(]@PY[k][struct] @PY[n][request_queue] @PY[o][*]@PY[n][q]@PY[p][,] @PY[k+kt][int] @PY[n][force]@PY[p][)]
@PY[p][{]
        @PY[k][struct] @PY[n][sstf_data] @PY[o][*]@PY[n][nd] @PY[o][=] @PY[n][q]@PY[o][-]@PY[o][>]@PY[n][elevator]@PY[o][-]@PY[o][>]@PY[n][elevator_data]@PY[p][;]
                
                @PY[k][if] @PY[p][(]@PY[n][q]@PY[o][=]@PY[o][=]@PY[n+nb][NULL]@PY[p][)] 
                        @PY[k][return] @PY[l+m+mi][0]@PY[p][;]
                
        @PY[k][if] @PY[p][(]@PY[o][!]@PY[n][list_empty]@PY[p][(]@PY[o][&]@PY[n][nd]@PY[o][-]@PY[o][>]@PY[n][queue]@PY[p][)]@PY[p][)] @PY[p][{]
                @PY[k][struct] @PY[n][request] @PY[o][*]@PY[n][rq]@PY[p][,] @PY[o][*]@PY[n][nextrq]@PY[p][,] @PY[o][*]@PY[n][prevrq]@PY[p][;]
                @PY[n][sector_t] @PY[n][next]@PY[p][,] @PY[n][prev]@PY[p][;]
                                
                @PY[n][nextrq] @PY[o][=] @PY[n][list_entry]@PY[p][(]@PY[n][nd]@PY[o][-]@PY[o][>]@PY[n][queue]@PY[p][.]@PY[n][next]@PY[p][,] @PY[k][struct] @PY[n][request]@PY[p][,] @PY[n][queuelist]@PY[p][)]@PY[p][;]
                @PY[n][next] @PY[o][=] @PY[n][blk_rq_pos]@PY[p][(]@PY[n][nextrq]@PY[p][)]@PY[p][;]
                                
                @PY[n][prevrq] @PY[o][=] @PY[n][list_entry]@PY[p][(]@PY[n][nd]@PY[o][-]@PY[o][>]@PY[n][queue]@PY[p][.]@PY[n][prev]@PY[p][,] @PY[k][struct] @PY[n][request]@PY[p][,] @PY[n][queuelist]@PY[p][)]@PY[p][;]
                @PY[n][prev] @PY[o][=] @PY[n][blk_rq_pos]@PY[p][(]@PY[n][prevrq]@PY[p][)]@PY[p][;]
                                                                
                @PY[k][if]@PY[p][(]@PY[n][nd]@PY[o][-]@PY[o][>]@PY[n][direction] @PY[o][>] @PY[l+m+mi][0] @PY[o][&]@PY[o][&] @PY[n][next] @PY[o][>] @PY[n][prev]@PY[p][)] @PY[p][{]
                        @PY[c+cm][/* MOVE UP */]
                        @PY[n][rq] @PY[o][=] @PY[n][nextrq]@PY[p][;]
                @PY[p][}] @PY[k][else] @PY[k][if]@PY[p][(]@PY[n][nd]@PY[o][-]@PY[o][>]@PY[n][direction] @PY[o][<] @PY[l+m+mi][0] @PY[o][&]@PY[o][&] @PY[n][next] @PY[o][<] @PY[n][prev]@PY[p][)] @PY[p][{]
                        @PY[c+cm][/* UPPER BOUND */]
                        @PY[n][rq] @PY[o][=] @PY[n][prevrq]@PY[p][;]
                        @PY[n][nd]@PY[o][-]@PY[o][>]@PY[n][direction] @PY[o][=] @PY[o][-]@PY[l+m+mi][1]@PY[p][;]
                @PY[p][}] @PY[k][else] @PY[k][if]@PY[p][(]@PY[n][nd]@PY[o][-]@PY[o][>]@PY[n][direction] @PY[o][<] @PY[l+m+mi][0] @PY[o][&]@PY[o][&] @PY[n][next] @PY[o][<] @PY[n][prev]@PY[p][)] @PY[p][{]
                        @PY[c+cm][/* Move DOWN */]
                        @PY[n][rq] @PY[o][=] @PY[n][prevrq]@PY[p][;]
                @PY[p][}] @PY[k][else] @PY[p][{]
                        @PY[c+cm][/* LOWER BOUND */]
                        @PY[n][rq] @PY[o][=] @PY[n][nextrq]@PY[p][;]
                        @PY[n][nd]@PY[o][-]@PY[o][>]@PY[n][direction] @PY[o][=] @PY[l+m+mi][1]@PY[p][;]
                @PY[p][}]
                @PY[c+cm][/* remove request */] 
                @PY[n][list_del_init]@PY[p][(]@PY[o][&]@PY[n][rq]@PY[o][-]@PY[o][>]@PY[n][queuelist]@PY[p][)]@PY[p][;]
		@PY[n][nd]@PY[o][-]@PY[o][>]@PY[n][queue_count]@PY[o][-]@PY[o][-]@PY[p][;]
                @PY[n][nd]@PY[o][-]@PY[o][>]@PY[n][head_pos] @PY[o][=] @PY[n][blk_rq_pos]@PY[p][(]@PY[n][rq]@PY[p][)]  @PY[o][+] @PY[n][blk_rq_sectors]@PY[p][(]@PY[n][rq]@PY[p][)] @PY[o][-] @PY[l+m+mi][1]@PY[p][;]
                @PY[n][elv_dispatch_sort]@PY[p][(]@PY[n][q]@PY[p][,] @PY[n][rq]@PY[p][)]@PY[p][;]
                @PY[c+cm][/* update queue head position]
@PY[c+cm][                sstf_balance(nd); */]
                                
                @PY[k][if]@PY[p][(]@PY[n][rq_data_dir]@PY[p][(]@PY[n][rq]@PY[p][)] @PY[o][=]@PY[o][=] @PY[l+m+mi][0]@PY[p][)]
                        @PY[n][printk]@PY[p][(]@PY[n][KERN_INFO] @PY[l+s]["]@PY[l+s][@PYZlb[]SSTF@PYZrb[] dsp READ %ld]@PY[l+s+se][\n]@PY[l+s]["]@PY[p][,]
					@PY[p][(]@PY[k+kt][long]@PY[p][)]@PY[n][blk_rq_sectors]@PY[p][(]@PY[n][rq]@PY[p][)]@PY[p][)]@PY[p][;]
                @PY[k][else]
                        @PY[n][printk]@PY[p][(]@PY[n][KERN_INFO] @PY[l+s]["]@PY[l+s][@PYZlb[]SSTF@PYZrb[] dsp WRITE %ld]@PY[l+s+se][\n]@PY[l+s]["]@PY[p][,]
					@PY[p][(]@PY[k+kt][long]@PY[p][)]@PY[n][blk_rq_sectors]@PY[p][(]@PY[n][rq]@PY[p][)]@PY[p][)]@PY[p][;]
                @PY[k][return] @PY[l+m+mi][1]@PY[p][;]
        @PY[p][}]
        @PY[k][return] @PY[l+m+mi][0]@PY[p][;]
@PY[p][}]

@PY[k][static] @PY[k+kt][void] @PY[n+nf][sstf_add_request]@PY[p][(]@PY[k][struct] @PY[n][request_queue] @PY[o][*]@PY[n][q]@PY[p][,] @PY[k][struct] @PY[n][request] @PY[o][*]@PY[n][rq]@PY[p][)]
@PY[p][{]
        @PY[k][struct] @PY[n][sstf_data] @PY[o][*]@PY[n][sd] @PY[o][=] @PY[n][q]@PY[o][-]@PY[o][>]@PY[n][elevator]@PY[o][-]@PY[o][>]@PY[n][elevator_data]@PY[p][;]
	@PY[k][struct] @PY[n][list_head] @PY[o][*]@PY[n][position]@PY[p][;]
        @PY[c+cm][/* BASE CASE */]
        @PY[k][if]@PY[p][(]@PY[n][list_empty]@PY[p][(]@PY[o][&]@PY[n][sd]@PY[o][-]@PY[o][>]@PY[n][queue]@PY[p][)]@PY[p][)]  @PY[p][{]
                @PY[n][list_add]@PY[p][(]@PY[o][&]@PY[n][rq]@PY[o][-]@PY[o][>]@PY[n][queuelist]@PY[p][,]@PY[o][&]@PY[n][sd]@PY[o][-]@PY[o][>]@PY[n][queue]@PY[p][)]@PY[p][;]
		@PY[n][sd]@PY[o][-]@PY[o][>]@PY[n][queue_count]@PY[o][+]@PY[o][+]@PY[p][;]
                @PY[k][return]@PY[p][;]
        @PY[p][}]

	@PY[n][sector_t] @PY[n][rq_sect]@PY[p][,] @PY[n][cur_sect]@PY[p][,] @PY[n][next_sect]@PY[p][;]
	@PY[n][rq_sect] @PY[o][=] @PY[n][blk_rq_pos]@PY[p][(]@PY[n][rq]@PY[p][)]@PY[p][;]

	@PY[n][list_for_each]@PY[p][(]@PY[n][position]@PY[p][,] @PY[o][&]@PY[n][sd]@PY[o][-]@PY[o][>]@PY[n][queue]@PY[p][)] @PY[p][{]
		
		@PY[k][if] @PY[p][(]@PY[n][sd]@PY[o][-]@PY[o][>]@PY[n][queue_count] @PY[o][=]@PY[o][=] @PY[l+m+mi][1]@PY[p][)] @PY[p][{]
			@PY[n][list_add]@PY[p][(]@PY[o][&]@PY[n][rq]@PY[o][-]@PY[o][>]@PY[n][queuelist]@PY[p][,] @PY[n][position]@PY[p][)]@PY[p][;]
			@PY[n][sd]@PY[o][-]@PY[o][>]@PY[n][queue_count]@PY[o][+]@PY[o][+]@PY[p][;]
			@PY[n][printk]@PY[p][(]@PY[n][KERN_INFO] @PY[l+s]["]@PY[l+s][@PYZlb[]SSTF@PYZrb[] added when 1 element long]@PY[l+s+se][\n]@PY[l+s]["]@PY[p][)]@PY[p][;]
	                @PY[k][return]@PY[p][;]
		@PY[p][}]
		
		@PY[k][struct] @PY[n][request] @PY[o][*]@PY[n][cur_rq] @PY[o][=] @PY[n][list_entry]@PY[p][(]@PY[n][position]@PY[p][,] 
				@PY[k][struct] @PY[n][request]@PY[p][,] @PY[n][queuelist]@PY[p][)]@PY[p][;]
		@PY[n][cur_sect] @PY[o][=] @PY[n][blk_rq_pos]@PY[p][(]@PY[n][cur_rq]@PY[p][)]@PY[p][;]
		
		@PY[k][struct] @PY[n][request] @PY[o][*]@PY[n][next_rq] @PY[o][=] @PY[n][list_entry]@PY[p][(]@PY[n][position]@PY[o][-]@PY[o][>]@PY[n][next]@PY[p][,] 
				@PY[k][struct] @PY[n][request]@PY[p][,] @PY[n][queuelist]@PY[p][)]@PY[p][;]
		@PY[n][next_sect] @PY[o][=] @PY[n][blk_rq_pos]@PY[p][(]@PY[n][next_rq]@PY[p][)]@PY[p][;]

		@PY[k][if] @PY[p][(]@PY[n][rq_sect] @PY[o][>]@PY[o][=] @PY[n][cur_sect] @PY[o][&]@PY[o][&] @PY[n][rq_sect] @PY[o][<]@PY[o][=] @PY[n][next_sect]@PY[p][)] @PY[p][{]
			@PY[n][list_add]@PY[p][(]@PY[o][&]@PY[n][rq]@PY[o][-]@PY[o][>]@PY[n][queuelist]@PY[p][,] @PY[n][position]@PY[p][)]@PY[p][;]
			@PY[n][sd]@PY[o][-]@PY[o][>]@PY[n][queue_count]@PY[o][+]@PY[o][+]@PY[p][;]
			@PY[n][printk]@PY[p][(]@PY[n][KERN_INFO] @PY[l+s]["]@PY[l+s][@PYZlb[]SSTF@PYZrb[] added in Sort]@PY[l+s+se][\n]@PY[l+s]["]@PY[p][)]@PY[p][;]
	                @PY[k][return]@PY[p][;]
		@PY[p][}]
	@PY[p][}]
        @PY[c+cm][/* now add at the correct position */]
        @PY[n][list_add_tail]@PY[p][(]@PY[o][&]@PY[n][rq]@PY[o][-]@PY[o][>]@PY[n][queuelist]@PY[p][,] @PY[o][&]@PY[n][sd]@PY[o][-]@PY[o][>]@PY[n][queue]@PY[p][)]@PY[p][;]
	@PY[n][sd]@PY[o][-]@PY[o][>]@PY[n][queue_count]@PY[o][+]@PY[o][+]@PY[p][;]
        @PY[n][printk]@PY[p][(]@PY[n][KERN_INFO] @PY[l+s]["]@PY[l+s][@PYZlb[]SSTF@PYZrb[] added to end]@PY[l+s+se][\n]@PY[l+s]["]@PY[p][)]@PY[p][;]
@PY[p][}]

@PY[k][static] @PY[k][struct] @PY[n][request] @PY[o][*]
@PY[n+nf][sstf_former_request]@PY[p][(]@PY[k][struct] @PY[n][request_queue] @PY[o][*]@PY[n][q]@PY[p][,] @PY[k][struct] @PY[n][request] @PY[o][*]@PY[n][rq]@PY[p][)]
@PY[p][{]
        @PY[k][struct] @PY[n][sstf_data] @PY[o][*]@PY[n][nd] @PY[o][=] @PY[n][q]@PY[o][-]@PY[o][>]@PY[n][elevator]@PY[o][-]@PY[o][>]@PY[n][elevator_data]@PY[p][;]

        @PY[k][if] @PY[p][(]@PY[n][rq]@PY[o][-]@PY[o][>]@PY[n][queuelist]@PY[p][.]@PY[n][prev] @PY[o][=]@PY[o][=] @PY[o][&]@PY[n][nd]@PY[o][-]@PY[o][>]@PY[n][queue]@PY[p][)]
                @PY[k][return] @PY[n+nb][NULL]@PY[p][;]
        @PY[k][return] @PY[n][list_entry]@PY[p][(]@PY[n][rq]@PY[o][-]@PY[o][>]@PY[n][queuelist]@PY[p][.]@PY[n][prev]@PY[p][,] @PY[k][struct] @PY[n][request]@PY[p][,] @PY[n][queuelist]@PY[p][)]@PY[p][;]
@PY[p][}]

@PY[k][static] @PY[k][struct] @PY[n][request] @PY[o][*]
@PY[n+nf][sstf_latter_request]@PY[p][(]@PY[k][struct] @PY[n][request_queue] @PY[o][*]@PY[n][q]@PY[p][,] @PY[k][struct] @PY[n][request] @PY[o][*]@PY[n][rq]@PY[p][)]
@PY[p][{]
        @PY[k][struct] @PY[n][sstf_data] @PY[o][*]@PY[n][nd] @PY[o][=] @PY[n][q]@PY[o][-]@PY[o][>]@PY[n][elevator]@PY[o][-]@PY[o][>]@PY[n][elevator_data]@PY[p][;]

        @PY[k][if] @PY[p][(]@PY[n][rq]@PY[o][-]@PY[o][>]@PY[n][queuelist]@PY[p][.]@PY[n][next] @PY[o][=]@PY[o][=] @PY[o][&]@PY[n][nd]@PY[o][-]@PY[o][>]@PY[n][queue]@PY[p][)]
                @PY[k][return] @PY[n+nb][NULL]@PY[p][;]
        @PY[k][return] @PY[n][list_entry]@PY[p][(]@PY[n][rq]@PY[o][-]@PY[o][>]@PY[n][queuelist]@PY[p][.]@PY[n][next]@PY[p][,] @PY[k][struct] @PY[n][request]@PY[p][,] @PY[n][queuelist]@PY[p][)]@PY[p][;]
@PY[p][}]

@PY[k][static] @PY[k+kt][void] @PY[o][*]@PY[n+nf][sstf_init_queue]@PY[p][(]@PY[k][struct] @PY[n][request_queue] @PY[o][*]@PY[n][q]@PY[p][)]
@PY[p][{]
        @PY[k][struct] @PY[n][sstf_data] @PY[o][*]@PY[n][nd]@PY[p][;]

        @PY[n][nd] @PY[o][=] @PY[n][kmalloc_node]@PY[p][(]@PY[k][sizeof]@PY[p][(]@PY[o][*]@PY[n][nd]@PY[p][)]@PY[p][,] @PY[n][GFP_KERNEL]@PY[p][,] @PY[n][q]@PY[o][-]@PY[o][>]@PY[n][node]@PY[p][)]@PY[p][;]
        @PY[k][if] @PY[p][(]@PY[o][!]@PY[n][nd]@PY[p][)]
                @PY[k][return] @PY[n+nb][NULL]@PY[p][;]
        @PY[n][INIT_LIST_HEAD]@PY[p][(]@PY[o][&]@PY[n][nd]@PY[o][-]@PY[o][>]@PY[n][queue]@PY[p][)]@PY[p][;]
        @PY[k][return] @PY[n][nd]@PY[p][;]
@PY[p][}]

@PY[k][static] @PY[k+kt][void] @PY[n+nf][sstf_exit_queue]@PY[p][(]@PY[k][struct] @PY[n][elevator_queue] @PY[o][*]@PY[n][e]@PY[p][)]
@PY[p][{]
        @PY[k][struct] @PY[n][sstf_data] @PY[o][*]@PY[n][nd] @PY[o][=] @PY[n][e]@PY[o][-]@PY[o][>]@PY[n][elevator_data]@PY[p][;]

        @PY[n][BUG_ON]@PY[p][(]@PY[o][!]@PY[n][list_empty]@PY[p][(]@PY[o][&]@PY[n][nd]@PY[o][-]@PY[o][>]@PY[n][queue]@PY[p][)]@PY[p][)]@PY[p][;]
        @PY[n][kfree]@PY[p][(]@PY[n][nd]@PY[p][)]@PY[p][;]
@PY[p][}]

@PY[k][static] @PY[k][struct] @PY[n][elevator_type] @PY[n][elevator_sstf] @PY[o][=] @PY[p][{]
        @PY[p][.]@PY[n][ops] @PY[o][=] @PY[p][{]
                @PY[p][.]@PY[n][elevator_merge_req_fn]                @PY[o][=] @PY[n][sstf_merged_requests]@PY[p][,]
                @PY[p][.]@PY[n][elevator_dispatch_fn]                @PY[o][=] @PY[n][sstf_dispatch]@PY[p][,]
                @PY[p][.]@PY[n][elevator_add_req_fn]                @PY[o][=] @PY[n][sstf_add_request]@PY[p][,]
                @PY[p][.]@PY[n][elevator_former_req_fn]     @PY[o][=] @PY[n][sstf_former_request]@PY[p][,]
                @PY[p][.]@PY[n][elevator_latter_req_fn]     @PY[o][=] @PY[n][sstf_latter_request]@PY[p][,]
                @PY[p][.]@PY[n][elevator_init_fn]           @PY[o][=] @PY[n][sstf_init_queue]@PY[p][,]
                @PY[p][.]@PY[n][elevator_exit_fn]           @PY[o][=] @PY[n][sstf_exit_queue]@PY[p][,]
        @PY[p][}]@PY[p][,]
        @PY[p][.]@PY[n][elevator_name] @PY[o][=] @PY[l+s]["]@PY[l+s][sstf]@PY[l+s]["]@PY[p][,]
        @PY[p][.]@PY[n][elevator_owner] @PY[o][=] @PY[n][THIS_MODULE]@PY[p][,]
@PY[p][}]@PY[p][;]

@PY[k][static] @PY[k+kt][int] @PY[n][__init] @PY[n+nf][sstf_init]@PY[p][(]@PY[k+kt][void]@PY[p][)]
@PY[p][{]
        @PY[n][elv_register]@PY[p][(]@PY[o][&]@PY[n][elevator_sstf]@PY[p][)]@PY[p][;]

        @PY[k][return] @PY[l+m+mi][0]@PY[p][;]
@PY[p][}]

@PY[k][static] @PY[k+kt][void] @PY[n][__exit] @PY[n+nf][sstf_exit]@PY[p][(]@PY[k+kt][void]@PY[p][)]
@PY[p][{]
        @PY[n][elv_unregister]@PY[p][(]@PY[o][&]@PY[n][elevator_sstf]@PY[p][)]@PY[p][;]
@PY[p][}]

@PY[n][module_init]@PY[p][(]@PY[n][sstf_init]@PY[p][)]@PY[p][;]
@PY[n][module_exit]@PY[p][(]@PY[n][sstf_exit]@PY[p][)]@PY[p][;]


@PY[n][MODULE_AUTHOR]@PY[p][(]@PY[l+s]["]@PY[l+s][CS411 - GROUP14]@PY[l+s]["]@PY[p][)]@PY[p][;]
@PY[n][MODULE_LICENSE]@PY[p][(]@PY[l+s]["]@PY[l+s][GPL]@PY[l+s]["]@PY[p][)]@PY[p][;]
@PY[n][MODULE_DESCRIPTION]@PY[p][(]@PY[l+s]["]@PY[l+s][SSTF IO scheduler]@PY[l+s]["]@PY[p][)]@PY[p][;]
\end{Verbatim}
